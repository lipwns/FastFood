<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Item</title>
    <link rel="stylesheet" th:href="@{/styles/css/obrigatorio.css}">
    <link rel="stylesheet" th:href="@{/styles/css/forms.css}">
    <link rel="stylesheet" th:href="@{/styles/css/cardapioAdicionar.css}">
</head>
<body>

<!-- Cabeçalho -->
<div class="header">
    <img width="90px" height="90px" th:src="@{/images/bk.png}" alt="Logo do projeto"/>
</div>

<!-- Menu Superior -->
<div class="menu">
    <div class="botoes-nav">
        <a class="btn" th:href="@{/fastfood/ingredientes/listar}">Ingredientes</a>
        <a class="btn active" th:href="@{/fastfood/cardapio/listar}">Cardápio</a>
        <a class="btn" th:href="@{/fastfood/pedidos/listar}">Pedidos</a>
    </div>
</div>

<!-- Corpo -->
<div class="container-form">
    <!-- Formulário -->
    <div class="form">
        <h1>Adicionar Item ao Cardápio</h1>

        <form th:action="@{/fastfood/cardapio/salvar}" th:object="${item}" method="post">
            <label for="nome">Nome do Item:</label>
            <input type="text" id="nome" th:field="*{nome}" placeholder="Ex: X-Burger" autocomplete="off" required/>

            <label for="descricao">Descrição:</label>
            <textarea id="descricao" th:field="*{descricao}" placeholder="Ex: Pão, carne, queijo" rows="4" cols="45" maxlength="255" required></textarea>

            <label for="valor">Valor (R$):</label>
            <input type="number" id="valor" th:field="*{preco}" step="0.01" min="0" placeholder="Ex: 15.50" required/>

            <!-- Seção de Ingredientes -->
            <div class="ingredientes-section">
                <h3>Ingredientes do Item</h3>
                <p style="margin-bottom: 15px;">
                    Selecione os ingredientes e defina as quantidades:
                </p>

                <div th:if="${ingredientesDisponiveis != null and !ingredientesDisponiveis.isEmpty()}">
                    <div th:each="ing, iterStat : ${ingredientesDisponiveis}" class="ingrediente-item">
                        <input type="checkbox"
                               th:id="'check_' + ${ing.id}"
                               th:data-index="${iterStat.index}"
                               th:value="${ing.id}"
                               onclick="toggleQuantidade(this)"/>

                        <label th:for="'check_' + ${ing.id}" th:text="${ing.nome}">Ingrediente</label>

                        <input type="number"
                               th:id="'qtd_' + ${ing.id}"
                               min="1"
                               value="1"
                               placeholder="Qtd"
                               disabled/>
                    </div>
                </div>

                <div th:if="${ingredientesDisponiveis == null or ingredientesDisponiveis.isEmpty()}">
                    <p>Nenhum ingrediente cadastrado.</p>
                    <a class="btn-ingredientes" th:href="@{/fastfood/ingredientes/criar}">
                        Cadastrar Ingredientes
                    </a>
                </div>
            </div>

            <!-- Container oculto para os inputs que serão enviados -->
            <div id="ingredientes-container" style="display: none;"></div>

            <button type="submit">Adicionar Item</button>
        </form>
    </div>
</div>

<script>
    function toggleQuantidade(checkbox) {
        const id = checkbox.value;
        const qtdInput = document.getElementById('qtd_' + id);

        if (checkbox.checked) {
            qtdInput.disabled = false;
            qtdInput.required = true;
        } else {
            qtdInput.disabled = true;
            qtdInput.required = false;
            qtdInput.value = '1';
        }
    }

    document.querySelector('form').addEventListener('submit', function(e) {
        e.preventDefault();

        // Limpa o container de ingredientes
        const container = document.getElementById('ingredientes-container');
        container.innerHTML = '';

        // Pega todos os checkboxes marcados
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');

        // Cria os inputs hidden para cada ingrediente selecionado
        checkboxes.forEach(function(checkbox, index) {
            const id = checkbox.value;
            const qtdInput = document.getElementById('qtd_' + id);
            const quantidade = qtdInput.value;

            // Cria input para o ID do ingrediente
            const inputId = document.createElement('input');
            inputId.type = 'hidden';
            inputId.name = 'ingredientes[' + index + '].ingrediente.id';
            inputId.value = id;
            container.appendChild(inputId);

            // Cria input para a quantidade
            const inputQtd = document.createElement('input');
            inputQtd.type = 'hidden';
            inputQtd.name = 'ingredientes[' + index + '].quantidade';
            inputQtd.value = quantidade;
            container.appendChild(inputQtd);
        });

        // Agora submete o formulário
        this.submit();
    });
</script>
</body>
</html>